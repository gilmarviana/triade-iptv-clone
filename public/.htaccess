# Otimizações de Performance e Cache
# ======================================

# Compressão Gzip/Brotli
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/json
</IfModule>

# Cache para arquivos estáticos com hash
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Arquivos JS/CSS com hash - cache por 1 ano
  <FilesMatch "\.(js|css)$">
    ExpiresDefault "access plus 1 year"
    Header set Cache-Control "public, immutable"
  </FilesMatch>
  
  # Imagens - cache por 1 ano
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|ico|svg)$">
    ExpiresDefault "access plus 1 year"
    Header set Cache-Control "public, immutable"
  </FilesMatch>
  
  # Fontes - cache por 1 ano
  <FilesMatch "\.(woff|woff2|ttf|eot)$">
    ExpiresDefault "access plus 1 year"
    Header set Cache-Control "public, immutable"
  </FilesMatch>
  
  # HTML - cache por 1 hora
  <FilesMatch "\.(html|htm)$">
    ExpiresDefault "access plus 1 hour"
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>
  
  # Outros arquivos - cache por 1 mês
  ExpiresDefault "access plus 1 month"
</IfModule>

# Headers de segurança e performance
<IfModule mod_headers.c>
  # HSTS (HTTP Strict Transport Security)
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
  
  # X-Content-Type-Options
  Header always set X-Content-Type-Options "nosniff"
  
  # X-Frame-Options
  Header always set X-Frame-Options "SAMEORIGIN"
  
  # X-XSS-Protection
  Header always set X-XSS-Protection "1; mode=block"
  
  # Referrer Policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Permissions Policy
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  
  # Remove ETags para melhor cache
  Header unset ETag
</IfModule>

# Otimizações para React Router (SPA)
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Redirecionar todas as rotas para index.html (exceto arquivos existentes)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ /index.html [QSA,L]
</IfModule>

# Desabilitar logs desnecessários
<IfModule mod_log_config.c>
  LogLevel warn
</IfModule>

# Otimizações de MIME types
<IfModule mod_mime.c>
  AddType application/javascript .js
  AddType text/css .css
  AddType image/webp .webp
  AddType font/woff2 .woff2
  AddType font/woff .woff
  AddType application/font-woff .woff
  AddType application/font-woff2 .woff2
</IfModule>

# Configurações de performance
<IfModule mod_headers.c>
  # Preload hints para recursos críticos
  <FilesMatch "index\.html$">
    Header always set Link "</static/css/main.css>; rel=preload; as=style"
    Header always set Link "</static/js/main.js>; rel=preload; as=script"
  </FilesMatch>
</IfModule> 