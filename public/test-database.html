<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Teste Database API - IPTV Barato</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        button { background: #ffb300; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px; cursor: pointer; }
        button:hover { background: #ff9800; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #ffb300; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ Teste do Sistema de Banco de Dados IPTV</h1>
        <p>Esta pÃ¡gina demonstra como o localStorage foi substituÃ­do pelo banco de dados.</p>

        <h2>ğŸ”§ Testes de API</h2>
        
        <div>
            <button onclick="testUserProfile()">ğŸ‘¤ Testar Perfil do UsuÃ¡rio</button>
            <button onclick="testAddFavorite()">â­ Adicionar Favorito</button>
            <button onclick="testGetFavorites()">ğŸ“‹ Listar Favoritos</button>
            <button onclick="testAddHistory()">ğŸ“š Adicionar ao HistÃ³rico</button>
            <button onclick="testGetHistory()">ğŸ•’ Ver HistÃ³rico</button>
            <button onclick="testServers()">ğŸ–¥ï¸ Listar Servidores</button>
            <button onclick="testSearchHistory()">ğŸ” HistÃ³rico de Pesquisas</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ Limpar Resultados</button>
        </div>

        <div id="results"></div>
    </div>

    <!-- Database API -->
    <script src="/js/database-api.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');

        function showResult(title, data, isError = false) {
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function showError(title, error) {
            showResult(title, { error: error.message }, true);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function testUserProfile() {
            try {
                const profile = await window.dbAPI.getUserProfile();
                showResult('ğŸ‘¤ Perfil do UsuÃ¡rio', profile);
            } catch (error) {
                showError('ğŸ‘¤ Erro no Perfil', error);
            }
        }

        async function testAddFavorite() {
            try {
                const result = await window.dbAPI.addToFavorites('channel', 'test_channel_123');
                showResult('â­ Favorito Adicionado', result);
            } catch (error) {
                showError('â­ Erro ao Adicionar Favorito', error);
            }
        }

        async function testGetFavorites() {
            try {
                const favorites = await window.dbAPI.getFavorites();
                showResult('ğŸ“‹ Lista de Favoritos', favorites);
            } catch (error) {
                showError('ğŸ“‹ Erro nos Favoritos', error);
            }
        }

        async function testAddHistory() {
            try {
                const result = await window.dbAPI.addToHistory('movie', 'test_movie_456', 3600, 7200, 0.5, 3600);
                showResult('ğŸ“š HistÃ³rico Adicionado', result);
            } catch (error) {
                showError('ğŸ“š Erro no HistÃ³rico', error);
            }
        }

        async function testGetHistory() {
            try {
                const history = await window.dbAPI.getWatchHistory(10);
                showResult('ğŸ•’ HistÃ³rico de VisualizaÃ§Ã£o', history);
            } catch (error) {
                showError('ğŸ•’ Erro no HistÃ³rico', error);
            }
        }

        async function testServers() {
            try {
                const servers = await window.dbAPI.getServers();
                showResult('ğŸ–¥ï¸ Lista de Servidores', servers);
            } catch (error) {
                showError('ğŸ–¥ï¸ Erro nos Servidores', error);
            }
        }

        async function testSearchHistory() {
            try {
                await window.dbAPI.addToSearchHistory('filme de aÃ§Ã£o', 25);
                const searches = await window.dbAPI.getSearchHistory();
                showResult('ğŸ” HistÃ³rico de Pesquisas', searches);
            } catch (error) {
                showError('ğŸ” Erro na Pesquisa', error);
            }
        }

        // InicializaÃ§Ã£o automÃ¡tica
        document.addEventListener('DOMContentLoaded', function() {
            showResult('ğŸš€ Sistema Inicializado', {
                message: 'Database API carregada com sucesso!',
                localStorage_substituido: true,
                banco_de_dados: 'SQLite via Prisma',
                apis_disponiveis: [
                    'Perfil do usuÃ¡rio',
                    'Favoritos',
                    'HistÃ³rico de visualizaÃ§Ã£o', 
                    'HistÃ³rico de pesquisas',
                    'PreferÃªncias do usuÃ¡rio',
                    'Servidores IPTV',
                    'Canais, filmes e sÃ©ries'
                ]
            });
        });
    </script>
</body>
</html>
