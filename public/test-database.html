<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Teste Database API - IPTV Barato</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        button { background: #ffb300; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px; cursor: pointer; }
        button:hover { background: #ff9800; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #ffb300; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎬 Teste do Sistema de Banco de Dados IPTV</h1>
        <p>Esta página demonstra como o localStorage foi substituído pelo banco de dados.</p>

        <h2>🔧 Testes de API</h2>
        
        <div>
            <button onclick="testUserProfile()">👤 Testar Perfil do Usuário</button>
            <button onclick="testAddFavorite()">⭐ Adicionar Favorito</button>
            <button onclick="testGetFavorites()">📋 Listar Favoritos</button>
            <button onclick="testAddHistory()">📚 Adicionar ao Histórico</button>
            <button onclick="testGetHistory()">🕒 Ver Histórico</button>
            <button onclick="testServers()">🖥️ Listar Servidores</button>
            <button onclick="testSearchHistory()">🔍 Histórico de Pesquisas</button>
            <button onclick="clearResults()">🗑️ Limpar Resultados</button>
        </div>

        <div id="results"></div>
    </div>

    <!-- Database API -->
    <script src="/js/database-api.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');

        function showResult(title, data, isError = false) {
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function showError(title, error) {
            showResult(title, { error: error.message }, true);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function testUserProfile() {
            try {
                const profile = await window.dbAPI.getUserProfile();
                showResult('👤 Perfil do Usuário', profile);
            } catch (error) {
                showError('👤 Erro no Perfil', error);
            }
        }

        async function testAddFavorite() {
            try {
                const result = await window.dbAPI.addToFavorites('channel', 'test_channel_123');
                showResult('⭐ Favorito Adicionado', result);
            } catch (error) {
                showError('⭐ Erro ao Adicionar Favorito', error);
            }
        }

        async function testGetFavorites() {
            try {
                const favorites = await window.dbAPI.getFavorites();
                showResult('📋 Lista de Favoritos', favorites);
            } catch (error) {
                showError('📋 Erro nos Favoritos', error);
            }
        }

        async function testAddHistory() {
            try {
                const result = await window.dbAPI.addToHistory('movie', 'test_movie_456', 3600, 7200, 0.5, 3600);
                showResult('📚 Histórico Adicionado', result);
            } catch (error) {
                showError('📚 Erro no Histórico', error);
            }
        }

        async function testGetHistory() {
            try {
                const history = await window.dbAPI.getWatchHistory(10);
                showResult('🕒 Histórico de Visualização', history);
            } catch (error) {
                showError('🕒 Erro no Histórico', error);
            }
        }

        async function testServers() {
            try {
                const servers = await window.dbAPI.getServers();
                showResult('🖥️ Lista de Servidores', servers);
            } catch (error) {
                showError('🖥️ Erro nos Servidores', error);
            }
        }

        async function testSearchHistory() {
            try {
                await window.dbAPI.addToSearchHistory('filme de ação', 25);
                const searches = await window.dbAPI.getSearchHistory();
                showResult('🔍 Histórico de Pesquisas', searches);
            } catch (error) {
                showError('🔍 Erro na Pesquisa', error);
            }
        }

        // Inicialização automática
        document.addEventListener('DOMContentLoaded', function() {
            showResult('🚀 Sistema Inicializado', {
                message: 'Database API carregada com sucesso!',
                localStorage_substituido: true,
                banco_de_dados: 'SQLite via Prisma',
                apis_disponiveis: [
                    'Perfil do usuário',
                    'Favoritos',
                    'Histórico de visualização', 
                    'Histórico de pesquisas',
                    'Preferências do usuário',
                    'Servidores IPTV',
                    'Canais, filmes e séries'
                ]
            });
        });
    </script>
</body>
</html>
